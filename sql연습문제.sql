ALTER SESSION SET "_ORACLE_SCRIPT"=true;
CREATE USER shop IDENTIFIED BY 1234;
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO shop;

create table Customer (
    CID VARCHAR2(20) PRIMARY KEY,
    NAME VARCHAR2(20) NOT NULL,
    HP  CHAR(13) UNIQUE,
    ADDRESS VARCHAR2(200),
    RDATE DATE NOT NULL
    );
    DROP TABLE Customer;
 
CREATE TABLE Product (
PNO NUMBER(4) PRIMARY KEY,
PNAME VARCHAR2(30) NOT NULL,
STOCK NUMBER DEFAULT 0,
PRICE NUMBER,
COMPANY VARCHAR2(20)
);

CREATE TABLE orders (
ORD_NO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
ORD_CID VARCHAR2(20) NOT NULL,
ORD_PNO NUMBER(4) NOT NULL,
ORD_CNT NUMBER DEFAULT 1,
ORD_DATE DATE NOT NULL
);

INSERT INTO CUSTOMER VALUES ('C101','김유신','010-1234-1001','김해시 봉황동','2022-01-01');
INSERT INTO CUSTOMER VALUES ('C102','김춘추','010-1234-1002','경주시 보문동','2022-01-02');
INSERT INTO CUSTOMER VALUES ('C103','장보고','010-1234-1003','완도군 청산면','2022-01-03');
INSERT INTO CUSTOMER VALUES ('C104','강감찬','010-1234-1004','서울시 마포구','2022-01-04');
INSERT INTO CUSTOMER VALUES ('C105','이성계',NULL,NULL,'2022-01-05');
INSERT INTO CUSTOMER VALUES ('C106','정철','010-1234-1006','경기도 용인시','2022-01-06');
INSERT INTO CUSTOMER VALUES ('C107','허준',NULL,NULL,'2022-01-07');
INSERT INTO CUSTOMER VALUES ('C108','이순신','010-1234-1008','서울시 영등포구','2022-01-08');
INSERT INTO CUSTOMER VALUES ('C109','송상현','010-1234-1009','부산시 동래구','2022-01-09');
INSERT INTO CUSTOMER VALUES ('C110','정약용','010-1234-1010','경기도 광주시','2022-01-10');

INSERT INTO Product VALUES (1, '새우깡',5000,1500,'농심');
INSERT INTO Product VALUES (2, '초코파이',2500,2500,'오리온');
INSERT INTO Product VALUES (3, '포카칩',3600,1700,'오리온');
INSERT INTO Product VALUES (4, '양파링',1250,1800,'농심');
INSERT INTO Product VALUES (5, '죠리퐁',2200,NULL,'크라운');
INSERT INTO Product VALUES (6, '마가렛트',3500,3500,'롯데');
INSERT INTO Product VALUES (7, '뿌셔뿌셔',1650,1200,'오뚜기');

INSERT INTO orders VALUES (1, 'C102',3,2,'2022-07-01 13:15:10');
INSERT INTO orders VALUES (2, 'C101',4,1,'2022-07-01 14:16:11');
INSERT INTO orders VALUES (3, 'C108',1,1,'2022-07-01 17:23:13');
INSERT INTO orders VALUES (4, 'C109',6,5,'2022-07-02 10:46:36');
INSERT INTO orders VALUES (5, 'C102',2,1,'2022-07-03 09:15:37');
INSERT INTO orders VALUES (6, 'C101',7,3,'2022-07-03 12:35:12');
INSERT INTO orders VALUES (7, 'C110',1,2,'2022-07-04 16:55:36');
INSERT INTO orders VALUES (8, 'C104',2,4,'2022-07-04 14:23:23');
INSERT INTO orders VALUES (9, 'C102',1,3,'2022-07-04 21:54:54');
INSERT INTO orders VALUES (10, 'C107',6,1,'2022-07-05 14:21:03');

SELECT * FROM CUSTOMER;
SELECT CID,NAME,HP FROM CUSTOMER;
SELECT * FROM PRODUCT;
SELECT COMPANY FROM PRODUCT;
SELECT DISTINCT COMPANY FROM PRODUCT;
SELECT PNAME,PRICE FROM PRODUCT;
SELECT PNAME, TO_NUMBER(REPLACE(price, '-', '')) + 500 as 조정단가 FROM PRODUCT;
SELECT pname, stock, price FROM product WHERE company LIKE '%오리온%';
select ord_pno, ord_cnt, ord_date from orders where ord_cid = 'C102';
select ord_pno, ord_cnt, ord_date 
    from orders where ord_cid = 'C102' and ord_cnt >= 2;
SELECT * FROM PRODUCT WHERE PRICE >= 1000 AND PRICE <= 2000;  
SELECT CID, NAME, HP, ADDRESS FROM CUSTOMER WHERE NAME LIKE '__';
SELECT CID, NAME, HP, ADDRESS FROM CUSTOMER WHERE LENGTH(NAME) = 2;
SELECT * FROM CUSTOMER WHERE HP IS NULL;
SELECT *FROM CUSTOMER WHERE ADDRESS IS NOT NULL;
SELECT * FROM CUSTOMER ORDER BY RDATE DESC;
SELECT * FROM ORDERS WHERE Ord_cnt >= 3 ORDER BY ORD_CNT DESC, ORD_PNO ASC;
SELECT AVG(PRICE) FROM PRODUCT;
SELECT SUM(STOCK) AS "재고량 합계" FROM PRODUCT WHERE COMPANY = '농심';
SELECT COUNT(*) AS 고객수 FROM CUSTOMER;
SELECT COUNT(DISTINCT COMPANY) AS "제조업체 수" FROM PRODUCT;
SELECT ORD_PNO AS "주문 상품번호", SUM(ORD_CNT) AS "총 주문수량 " FROM ORDERS
    GROUP BY ORD_PNO ORDER BY ORD_PNO ASC;
SELECT COMPANY AS 제조업체, COUNT(*) AS 제품수 , MAX(PRICE) AS 최고가 FROM PRODUCT
    GROUP BY COMPANY ORDER BY COMPANY ASC;
SELECT COMPANY AS 제조업체, COUNT(*) AS 제품수 , MAX(PRICE) AS 최고가 FROM PRODUCT
    GROUP BY COMPANY HAVING COUNT(*)  >= 2 ;
SELECT ORD_PNO, ORD_CID, SUM(ORD_CNT) AS "총 주문수량" FROM ORDERS
    GROUP BY ORD_CID, ORD_PNO ORDER BY ORD_PNO ASC;
SELECT ORD_CID, PNAME FROM ORDERS A
    JOIN PRODUCT B ON A.ORD_PNO = B.PNO WHERE ORD_CID = 'C102';
    
    SELECT ORD_CID, NAME , PNAME, ORD_DATE FROM ORDERS A
    JOIN CUSTOMER B ON A.ORD_CID = B.CID
    JOIN PRODUCT C ON  A.ORD_PNO = C.PNO
    //WHERE ORD_DATE LIKE '2022-07-03%';
    WHERE substr(ORD_DATE, 1, 10) = '2022-07-03';
